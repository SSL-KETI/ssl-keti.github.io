<!DOCTYPE HTML>
<!--
	Verti by HTML5 UP
	html5up.net | @ajlkn
	Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html>
	<head>
		<title>SSL</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
		<link rel="stylesheet" href="assets/css/main.css" />
	</head>
	<body class="is-preload homepage"> <!-- onload="getResultFromServer();"-->
		<!-- Getting former results
		<script>
			function getResultFromServer() {
				var jsonArray = new Object();
				jsonArray['getDataFromServer'] = ''
				jsonArray = JSON.stringify(jsonArray);
				$.ajax({
					type: "GET",
					url: "url/api/part1_KETI_cache",
					data: jsonArray,
					success:function(data){
						var obj = JSON.parse(data);
						obj = JSON.parse(obj[0])
						console.log(obj)
						if (Object.keys(obj).includes('scene_graph_json')) {
							$('#json_results1').html("");
							// KETI
							var jsonSceneGraph = obj.scene_graph_json;
							document.getElementById('json_results1_keti').style.visibility = 'visible';
							$('#json_results1_keti').html(jsonSceneGraph);
							
							var resultSceneGraph = document.createElement("img");
							resultSceneGraph.setAttribute("src", 'data:image/png;base64,' + obj.scene_graph); 
							resultSceneGraph.setAttribute("style", "max-width: 70%; height: auto;"); 
						}
					},
					error:function(data){
						alert(JSON.stringify(data));
					}
				});
			}
		</script>
		-->
		<div id="page-wrapper">

			<!-- Header -->
				<div id="header-wrapper" style="background-color: white;">
					<header id="header" class="container">

						<!-- Logo -->
							<div id="logo">
								<h1><a href="index2.html" style="background-color: white;"><strong style="color:#002178">SSL</strong></a></h1>
							</div>

						<!-- Nav -->
							<nav id="nav">
								<ul>
									<li><a href="index2.html">과제 개요</a></li>
									<li class="current">
										<a href="demo1.html">통합시연</a>
										<ul>
											<li><a href="demo1-12.html">Part 1</a></li>
											<li><a href="demo1-12.html#box2">Part 2</a></li>
											<li><a href="demo1-3.html">Part 3</a></li>
											<li><a href="demo1-4.html">Part 4</a></li>
										</ul>
									</li>
									<li>
										<a href="opensource.html">오픈소스</a>
										<ul>
											<li><a href="opensource.html">데이터셋</a></li>
											<li><a href="opensource2.html">Downstream Task</a></li>
										</ul>
									</li>
									<li><a href="contact.html">CONTACT</a></li>
								</ul>
							</nav>

					</header>
				</div>

			<!-- Main -->
			<div class="container" style="text-align: center;">
				<br/><br/>
				<h2 style="text-align: center; font-weight: 130; margin-bottom: 0.8em;">통합시연</h2>
				<hr color="black" width="10%" size="4px">
				<br/><br/>
				<div>
					<a href="demo1-12.html"><img src="images/home_1.png" onmouseover="this.src='images/home_1_fade.png'" onmouseout="this.src='images/home_1.png'" style="width: 25.33%; vertical-align: top;"></a><a href="demo1-3.html"><img src="images/home_2.png" onmouseover="this.src='images/home_2_fade.png'" onmouseout="this.src='images/home_2.png'" style="width: 46.74%; vertical-align: top;"></a><a href="demo1-4.html"><img src="images/home_3.png"  onmouseover="this.src='images/home_3_fade.png'" onmouseout="this.src='images/home_3.png'" style="width: 27.93%; vertical-align: top;"></a>
				</div>
				<button onclick="location.href='demo1.html'" style="width: 95%; background-color: #002178;">통합 시연</button>
				<br/><br/><br/>
			</div>

			<div id="main-wrapper" style="background-color: white;">
				<div class="container" id="box1">
					<h2 style="font-weight: 130; margin-bottom: 0.8em;">Part 1</h2>
					<hr color="black" width="10%" size="4px" style="margin-left: 0px;">
					<br/>
					<div style="font-size: 1.2em">영상 내 존재하는 객체들 간의 관계를 파악해 장면그래프로 상식화</div>
					<br/><br/>
					<strong>이미지 파일 : &nbsp;&nbsp;&nbsp;</strong>
					<input type="file" id="file_img1" accept="image/*" onchange="setImageThumbnail(event, '#image_container1');"/>
					<br/><br/>
					
					<div style="visibility: hidden">
						<input type="checkbox" id="checkbox_postech" name="postech" checked>
						<label for="postech" style="font-size: 1.5em">Postech</label> &nbsp;&nbsp;&nbsp;&nbsp;
						<input type="checkbox" id="checkbox_keti" name="keti">
						<label for="keti" style="font-size: 1.5em">KETI</label>
					</div>

					<br/>
					<input id="submit_1" type="submit" value="Run" onclick="submitData(event, 1, 'part1_POSTECH')" style="background-color: #002178; padding: 10px 17px 10px 17px">

					<br/><br/>
					<h4>파일 미리보기</h4>
					<div id="image_container1"><img src="examples/2.jpg"></div> 
					</p>
						
					<h4>결과</h4>
					<pre id="json_results1" style="max-height: 20em;">json result</pre>
					<canvas id="json_canvas_result1" width="800" height="600"></canvas>
					<!--
					<div id="json_results1" style="max-height: 20em;">json result</div>
					<pre id="json_results1_postech" style="max-height: 20em;">json result</pre>
					<pre id="json_results1_keti" style="max-height: 20em; visibility: hidden;">json results</pre>
					-->
				</div>
			</div>

			<div id="main-wrapper" style="background-color: #fbfbfb;">
				<div class="container" id="box2">
					<h2 style="font-weight: 130; margin-bottom: 0.8em;">Part 2</h2>
					<hr color="black" width="10%" size="4px" style="margin-left: 0px;">
					<br/>
					<div style="font-size: 1.2em">영상의 정교한 분석을 기반으로 객체의 기능, 외형, 속성 정보를 장면그래프로 상식화</div>
					<br/><br/>
					<strong>이미지 파일 : &nbsp;&nbsp;&nbsp;</strong>
					<input type="file" id="file_img2" accept="image/*" onchange="setImageThumbnail(event, '#image_container2');"/>
					<br/><br/>
					<strong>마스크 파일 : &nbsp;&nbsp;&nbsp;</strong>
					<input type="file" id="file_mask2" accept="image/*" onchange="setImageThumbnail(event, '#mask_container2');"/>
					<br/><br/>
					<strong>JSON 파일 : &nbsp;&nbsp;&nbsp;</strong>
					<input type="file" id="file_json2" accept="application/JSON" onchange="setJsonThumbnail(event, '#json_preview2')"/>
					<br/><br/>
					<input id="submit_2" type="submit" value="Run" onclick="submitData(event, 2, 'part2_UNIST')" style="background-color: #002178; padding: 10px 17px 10px 17px">
					<br/><br/>
					<h4>파일 미리보기</h4>
					<div class="row">
						<div class="column">
							이미지
							<div id="image_container2"><img src="examples/2023/masked_img.jpg" style="max-width:100%;"></div>
						</div>
						<div class="column">
							마스크
							<div id="mask_container2"><img src="examples/2023/mask.png" style="max-width:100%;"></div>
						</div>
					</div>
					<pre id="json_preview2" style="max-height: 20em;">{"image_id":9830,"image_name":"n15075141_47718.JPEG","objects":[{"object_id":1,"class_id":1,"class_name":"person","object_bbox":{"x":189,"y":76,"width":93,"height":292}},{"object_id":3,"class_id":55,"class_name":"ceiling","object_bbox":{"x":0,"y":0,"width":313,"height":66}},{"object_id":4,"class_id":63,"class_name":"wall","object_bbox":{"x":0,"y":0,"width":332,"height":412}},{"object_id":5,"class_id":1,"class_name":"person","object_bbox":{"x":42,"y":169,"width":238,"height":318}},{"object_id":6,"class_id":59,"class_name":"floor","object_bbox":{"x":0,"y":377,"width":332,"height":122}}],"predicates":[{"predicate_name":"wearing_a_T-shirt","predicate_id":113005,"subject_id":1,"object_id":-1},{"predicate_name":"wearing_shoes","predicate_id":113009,"subject_id":1,"object_id":-1},{"predicate_name":"standing","predicate_id":112016,"subject_id":1,"object_id":-1},{"predicate_name":"Front-view","predicate_id":120001,"subject_id":1,"object_id":-1},{"predicate_name":"male","predicate_id":111013,"subject_id":1,"object_id":-1},{"predicate_name":"Unknown","predicate_id":120006,"subject_id":3,"object_id":-1},{"predicate_name":"solid","predicate_id":114015,"subject_id":3,"object_id":-1},{"predicate_name":"metallic","predicate_id":114001,"subject_id":3,"object_id":-1},{"predicate_name":"with_bricks","predicate_id":113053,"subject_id":4,"object_id":-1},{"predicate_name":"standing","predicate_id":112016,"subject_id":4,"object_id":-1},{"predicate_name":"Unknown","predicate_id":120006,"subject_id":4,"object_id":-1},{"predicate_name":"stone","predicate_id":114010,"subject_id":4,"object_id":-1},{"predicate_name":"wearing_a_T-shirt","predicate_id":113005,"subject_id":5,"object_id":-1},{"predicate_name":"wearing_shoes","predicate_id":113009,"subject_id":5,"object_id":-1},{"predicate_name":"wearing_jeans","predicate_id":113011,"subject_id":5,"object_id":-1},{"predicate_name":"wearing_a_cap","predicate_id":113003,"subject_id":5,"object_id":-1},{"predicate_name":"sitting","predicate_id":112010,"subject_id":5,"object_id":-1},{"predicate_name":"hand_up","predicate_id":112004,"subject_id":5,"object_id":-1},{"predicate_name":"Side-view","predicate_id":120003,"subject_id":5,"object_id":-1},{"predicate_name":"male","predicate_id":111013,"subject_id":5,"object_id":-1},{"predicate_name":"Unknown","predicate_id":120006,"subject_id":6,"object_id":-1},{"predicate_name":"wooden","predicate_id":114003,"subject_id":6,"object_id":-1},{"predicate_name":"lower","predicate_id":220006,"subject_id":6,"object_id":1},{"predicate_name":"touch__contact","predicate_id":210096,"subject_id":6,"object_id":1},{"predicate_name":"lower","predicate_id":220006,"subject_id":6,"object_id":3},{"predicate_name":"lower","predicate_id":220006,"subject_id":6,"object_id":4},{"predicate_name":"touch__contact","predicate_id":210096,"subject_id":6,"object_id":4},{"predicate_name":"lower","predicate_id":220006,"subject_id":6,"object_id":5},{"predicate_name":"touch__contact","predicate_id":210096,"subject_id":6,"object_id":5}]}</pre>
					<canvas id="json_canvas_preview2" width="800" height="600"></canvas>
					<br/>
					<hr style="height:10px; background-color:gray;">
					<br/>
					<h4>결과</h4>
					<pre id="json_results2">json result</pre>
					<canvas id="json_canvas_result2" width="800" height="600"></canvas>
				</div>
			</div>

			<script>
				window.onload = function() {
					container = document.getElementById("box1");
					canvas_preview2 = document.getElementById("json_canvas_preview2");
					canvas_preview2.width = container.clientWidth - 50;
					var scene_graph = document.getElementById("json_preview2").innerText;
					visualize_json(scene_graph, "#json_canvas_preview2")

					json_canvas_result1 = document.getElementById("json_canvas_result1");
					json_canvas_result1.width = container.clientWidth - 50;

					json_canvas_result2 = document.getElementById("json_canvas_result2");
					json_canvas_result2.width = container.clientWidth - 50;
				}

				function submitData(event, num, name) {
					if(num == 1) { // Part 1
						var hasImage = false;
						var readerImg = new FileReader();

						var jsonArray = new Object();
						var base64image;

						$('#json_results'+num).html("loading...");
						//document.getElementById('json_results1_postech').style.visibility = 'hidden';
						//document.getElementById('json_results1_keti').style.visibility = 'hidden';
						
						var is_postech_checked = $('#checkbox_postech').prop("checked");
						var is_keti_checked = $('#checkbox_keti').prop("checked");
						var checked_boxes = [];
						if(is_postech_checked) {
							checked_boxes.push('part1_POSTECH')
						}
						if(is_keti_checked) {
							checked_boxes.push('part1_KETI')
						}
						var file_check = $("#file_img1").val();
						if(!file_check) {
							getBase64ImageFromURL('https://raw.githubusercontent.com/SSL-KETI/image_backup/main/2.jpg', input_url, num, checked_boxes);
						}
						else {
							var img = document.getElementById("file_img"+num).files[0];
							readerImg.readAsDataURL(img);

							readerImg.onload = function() {
								base64image = getBase64Image(readerImg);
								jsonArray['image_contents'] = base64image;

								jsonArray = JSON.stringify(jsonArray);
								for(var i=0; i < checked_boxes.length; i++) {
									postData(input_url+checked_boxes[i], jsonArray, num);
								}
							}
						}
					}
					else { // Part 2
						var readerImg = new FileReader();
						var readerJson = new FileReader();

						var jsonArray = new Object();
						var base64image;

						var file_check_img = $("#file_img2").val();
						var file_check_mask = $("#file_mask2").val();
						var file_check_json = $("#file_json2").val();
						
						// 파일을 넣지 않을 경우
						if(!file_check_img && !file_check_mask && !file_check_json) {
							$('#json_results'+num).html("loading...");
							img_url = 'https://raw.githubusercontent.com/SSL-KETI/ssl-keti.github.io/main/examples/2023/masked_img.jpg';
							mask_url = 'https://raw.githubusercontent.com/SSL-KETI/ssl-keti.github.io/main/examples/2023/mask.png';
							getBase64ImageFromURLBothImages(input_url+"part2_UNIST", num, img_url, mask_url, '');
						}
						// 파일을 넣을 경우
						else if(file_check_img && file_check_mask && file_check_json) {
							var img = document.getElementById("file_img"+num).files[0];
							var mask = document.getElementById("file_mask"+num).files[0];
							var json = document.getElementById("file_json"+num).files[0];
							readerImg.readAsDataURL(img);
							readerMask.readAsDataURL(mask);
							readerJson.readAsText(json);

							readerImg.onload = function() {
								readerMask.onload = function() {
									readerJson.onload = function() {
										$('#json_results'+num).html("loading...");
										var base64image = getBase64Image(readerImg);
										var base64mask = getBase64Image(readerMask);
										var jsonData = JSON.parse(readerJson.result);

										jsonArray['image_contents'] = base64image;
										jsonArray['mask_contents'] = base64mask
										jsonArray['scene_graph'] = jsonData;
										jsonArray = JSON.stringify(jsonArray);
										postData(input_url+"part2_UNIST", jsonArray, num);
									}
								}
							}
						}
						else {
							if(!file_check_img) {
								alert("이미지를 선택하세요.");
							}
							if(!file_check_mask) {
								alert("마스크를 선택하세요.");
							}
							if(!file_check_json) {
								alert("JSON을 선택하세요.");
							}
						}
					}
				}

				function getBase64ImageFromURL(image_url, input_url, num, checked_boxes){
					var img = new Image();
					img.setAttribute('crossOrigin', 'anonymous');
					
					img.onload = imgData => {
						var canvas = document.createElement("canvas");
						canvas.width = img.width;
						canvas.height = img.height;
						var ctx = canvas.getContext("2d");
						ctx.drawImage(img, 0, 0);
						var dataURL = canvas.toDataURL("image/png");
						var img_base64 = dataURL;
						var commaIndex = img_base64.indexOf(",");
						img_base64 = img_base64.slice(commaIndex+1);
						
						var jsonArray = new Object();
						jsonArray['image_contents'] = img_base64;
						jsonArray = JSON.stringify(jsonArray);

						for(var i=0; i < checked_boxes.length; i++) {
							postData(input_url+checked_boxes[i], jsonArray, num);
						}
					}
					img.src = image_url
				}
			</script>

			<!-- Footer -->
			<div id="footer-wrapper">
				<footer id="footer" class="container">
					<div class="row">
						<div class="col-3 col-6-medium col-12-small">

							<!-- Links -->
								<section class="widget links">
									<h3><a href="index2.html">과제 개요</a></h3>
								</section>

						</div>
						<div class="col-3 col-6-medium col-12-small">

							<!-- Links -->
								<section class="widget links">
									<h3><a href="demo1.html">통합시연</a></h3>
									<ul class="style2">
										<li><a href="demo1-12.html">Part 1</a></li>
										<li><a href="demo1-12.html#box2">Part 2</a></li>
										<li><a href="demo1-3.html">Part 3</a></li>
										<li><a href="demo1-4.html">Part 4</a></li>
									</ul>
								</section>

						</div>
						<div class="col-3 col-6-medium col-12-small">

							<!-- Links -->
								<section class="widget links">
									<h3><a href="opensource.html">오픈소스</a></h3>
									<ul class="style2">
										<li><a href="opensource.html">데이터셋</a></li>
										<li><a href="opensource2.html">Downstream Task</a></li>
									</ul>
								</section>

						</div>
						<div class="col-3 col-6-medium col-12-small">

							<!-- Links -->
								<section class="widget links">
									<h3><a href="contact.html">CONTACT</a></h3>
								</section>

						</div>
					</div>
					<div class="row">
						<div class="col-12">
							<div id="copyright">
								<ul class="menu">
									<li>&copy; KETI. All rights reserved</li><li>Design: <a href="http://html5up.net">HTML5 UP</a></li>
								</ul>
							</div>
						</div>
					</div>
				</footer>
			</div>

			</div>

		<!-- Scripts -->

			<script src="assets/js/jquery.min.js"></script>
			<script src="assets/js/jquery.dropotron.min.js"></script>
			<script src="assets/js/browser.min.js"></script>
			<script src="assets/js/breakpoints.min.js"></script>
			<script src="assets/js/util.js"></script>
			<script src="assets/js/main.js"></script>
			<script src="assets/js/arbor.js"></script>
			<script src="assets/js/graphics.js"></script>
			<script src="assets/js/renderer.js"></script>
			<script src="assets/js/thumbnail.js"></script>
			<script src="assets/js/main_connection_info.js"></script>
			<script src="assets/js/main_connection.js"></script>

	</body>
</html>
