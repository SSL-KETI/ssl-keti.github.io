<!DOCTYPE HTML>
<!--
	Verti by HTML5 UP
	html5up.net | @ajlkn
	Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html>
	<head>
		<title>SSL</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
		<link rel="stylesheet" href="assets/css/main.css" />
	</head>
	<body class="is-preload homepage">
		<div id="page-wrapper">

			<!-- Header -->
				<div id="header-wrapper" style="background-color: white;">
					<header id="header" class="container">

						<!-- Logo -->
							<div id="logo">
								<h1><a href="index.html" style="background-color: white;"><strong style="color:#002178">SSL</strong></a></h1>
							</div>

						<!-- Nav -->
							<nav id="nav">
								<ul>
									<li><a href="index.html">과제 개요</a></li>
									<li>
										<a href="demo1.html">통합시연</a>
										<ul>
											<li><a href="demo1-12.html">Part 1</a></li>
											<li><a href="demo1-12.html#box2">Part 2</a></li>
											<li><a href="demo1-3.html">Part 3</a></li>
											<li><a href="demo1-4.html">Part 4</a></li>
										</ul>
									</li>
									<li class="current"><a href="demo2.html">Downstream Task</a></li>
									<li><a href="opensource.html">오픈소스</a></li>
									<li><a href="contact.html">CONTACT</a></li>
								</ul>
							</nav>

					</header>
				</div>

			<!-- Main -->
			<div id="main-wrapper" style="background-color: white;">
				<div class="container" style="text-align: center;">
					<br/><br/>
					<h2 style="text-align: center; font-weight: 130; margin-bottom: 0.8em;">Downstream Task</h2>
					<hr color="black" width="10%" size="4px">
					<br/><br/><br/>

					<div class="row">
						<div class="col-4 col-12-medium">
								<a href="demo2-1.html"><img src="images/demo2_1.png" style="width: 100%;"></a>
						</div>
						<div class="col-4 col-12-medium">
								<a href="demo2-2.html"><img src="images/demo2_2.png" style="width: 100%;"></a>
						</div>
						<div class="col-4 col-12-medium">
								<a href="demo2-3.html"><img src="images/demo2_3.png" style="width: 100%;"></a>
						</div>
					</div>

					<div class="row">
						<div class="col-4 col-12-medium">
							<a href="demo2-4.html"><img src="images/demo2_4.png" style="width: 100%;"></a>
						</div>
						<div class="col-4 col-12-medium">
							<a href="demo2-5.html"><img src="images/demo2_5.png" style="width: 100%;"></a>
						</div>
					</div>

					<br/>
				</div>
			</div>

			<div id="main-wrapper" style="background-color: #fbfbfb;">
				<div class="container">
					<h2 style="font-weight: 130; margin-bottom: 0.8em;">Part 3</h2>
					<hr color="black" width="10%" size="4px" style="margin-left: 0px;">
					<br/>
					<div style="font-size: 1.2em">문서 내 지식관계 추출 정확도</div>
					<br/><br/>
					<p><h4>1. 파일 입력</h4></p>
						<strong>JSON 파일 : &nbsp;&nbsp;&nbsp;</strong>
						<input type="file" id="file_json" accept="application/JSON" onchange="setJsonThumbnail(event, 'json_preview')"/>
						<br/><br/><br/>
						<h4>파일 미리보기</h4>
						<pre id="json_preview">json file preview</pre>
						<input id="submit" type="submit" onclick="submitData(event, 'relation_extraction', true)" style="background-color: #002178; padding: 10px 17px 10px 17px">
						<br/><br/>
						<h4>결과</h4>
						<pre id=json_results>json results</pre>
						<br/><br/>

						<hr color="black" width="100%" size="4px">

						<br/>
						<p><h4>2. 사용자 텍스트 입력</h4></p>
						1) 문장을 아래에 입력하세요. <br/>
						2) 단어를 드래그하여 선택하세요. <br/>
						3) 선택한 단어가 맞으면 "단어 추가" 버튼을 누르세요. <br/>
						4) 단어 삭제를 원할 경우 해당 단어를 클릭하세요. <br/>
						5) 단어 선택을 원료했을 때, "JSON 생성" 버튼을 누르세요. <br/>
						6) JSON이 제대로 생성되었으면 "Submit" 버튼을 누르세요. <br/><br/>
						*** 선택된 단어는 subject, object 순서대로 입력됩니다. 짝수 개의 단어를 입력하세요. ***<br/>
						예) "사용자", "문장", "단어", "짝수" 를 선택할 경우, 각각 subject, object 순서로 ("사용자", "문장"), ("단어", "짝수") 로 묶입니다.
						<br/><br/>
						문장 입력 :<br/>
						<textarea id="sentence" style="width: 100%;
							border-color:rgb(221, 221, 221);
							resize:none;
							background: #f8f8f8;
							border-radius: 6px;
							border: solid 1px #e5e5e5;
							font-family: monospace;
							font-size: 0.9em;
							line-height: 1.75em;
							margin: 0 0 2em 0;
							overflow-x: auto;
							padding: 1em 1.5em;" placeholder="문장을 입력하세요." onselect="getSelectedText()"></textarea>
						<br/>
						선택된 단어 :
						<div class="row gtr-uniform gtr-50">
							<div class="col-9 col-12-mobilep">
								<pre id="word"/>
							</div>
							<div class="col-1 col-12-mobilep">
								<input type="button" value="단어 추가" class="fit" style="height:100%; background-color: #002178; padding: 10px 17px 10px 17px" onclick="addWord()"/>
							</div>
						</div>

						<br/>
						<div id="selected_words"></div>
						<!--
						<input type="submit" id="generator" value="JSON 생성" onclick="generateJson()" style="background-color: #002178; padding: 10px 17px 10px 17px">
						<br/><br/>
						<h4>생성된 JSON</h4>
						<pre id="json_preview_user">json preview</pre>-->
						<br/>
						<input id="submit" type="submit" onclick="submitData(event, 'relation_extraction', false)" style="background-color: #002178; padding: 10px 17px 10px 17px">
						<br/><br/>
						<h4>결과</h4>
						<pre id=json_results2>json results</pre>
				</div>
			</div>


			<script>
				function getSelectedText() {
					var txtarea = document.getElementById("sentence");
					var start = txtarea.selectionStart;
					var finish = txtarea.selectionEnd;
					var sel = txtarea.value.substring(start, finish);
					$('#word').html(sel + "   [" + start + "," + finish + "]");
				}
				
				var wordCount = 0;
				var wordArray = [];
				function addWord() {
					var word = document.getElementById("word").innerText;
					if(word == "							") {
						alert("문장에서 단어를 드래그하여 선택하세요.");
						return 1;
					}

					var wordarea = document.getElementById("selected_words");
					var button = document.createElement("input");
					button.setAttribute("type", "button");
					button.setAttribute("value", word);
					button.setAttribute("style", "background-color: silver; color: black; padding: 10px 17px 10px 17px; font-size: 1em");
					button.id = "word" + wordCount;
					button.onclick = function(event) {
						event.target.remove();

						var word_num = button.id.substring(4, button.id.length);
						var idx = wordArray.indexOf(word_num);
						wordArray.splice(idx, 1);
					};
					
					wordarea.append(button);
					wordarea.append("\u00A0");

					wordArray.push(wordCount + "");
					wordCount += 1;
				}

				function generateJson() {
					if(wordArray.length == 0) {
						alert("단어를 선택하세요.");
						return 1;
					}
					else if(wordArray.length % 2 != 0) {
						alert("짝수 개의 단어를 선택하세요.");
						return 1;
					}

					var sentence = document.getElementById("sentence");

					var json_doc = new Object();
					json_doc["text"] = sentence.value;
					json_doc["language"] = "kr";
					json_doc["domain"] = "common-sense";

					var pairs = [];
					var subject = "";
					var object = "";
					for(var i = 0; i < wordArray.length; i++) {
						var wordId = "word" + wordArray[i];
						var wordValue = document.getElementById(wordId).value;
						var splitedWord = wordValue.split("   ");
						var wordLocation = splitedWord[1];
						var splitedWordLocation = wordLocation.split(",");

						var start = splitedWordLocation[0].slice(1) * 1;
						var end = splitedWordLocation[1].slice(0, -1) * 1;
						if(i % 2 == 1) {
							object = [start, end-1];
							pairs.push([subject, object]);

							subject = "";
							object = "";
						}
						else {
							subject = [start, end-1];
						}
					}

					var jsonArray = new Object();
					jsonArray["doc"] = json_doc;
					jsonArray["arg_pairs"] = pairs;
					jsonArray = JSON.stringify(jsonArray);

					//$("#json_preview_user").html(jsonArray);
					return jsonArray;
				}

				function setJsonThumbnail(event, json_area) {
					var reader = new FileReader(); 
					reader.onload = function(event) { 
						$('#'+json_area).html("");
						$('#'+json_area).html(event.target.result);
					};
					reader.readAsText(event.target.files[0]);
				}

				function submitData(event, name, hasFile) {
					input_url = "https://ketiair.com:10001/api/" + name;

					if(hasFile) {
						var hasJson = false;
						var readerJson = new FileReader();

						alertIfFileNotSelected(readerJson);

						readerJson.onload = function() {
							$('#json_results').html("loading...");
							postData(input_url, readerJson.result, hasFile);
						}
					}
					else {
						// var generatedJson = document.getElementById("json_preview_user").innerText;
						var generatedJson = generateJson();
						$('#json_results2').html("loading...");
						postData(input_url, generatedJson, hasFile);
					}
				}

				function alertIfFileNotSelected(reader) {
					var json = document.getElementById("file_json").files[0];
					try {
						reader.readAsText(json);
					}
					catch(err) {
						alert("JSON 파일을 선택하세요.");
					}
				}

				function postData(input_url, jsonArray, hasFile) {
					$.ajax({
						type: "POST",
						url: input_url,
						data: jsonArray,
						beforeSend: function(xhr) {
							xhr.setRequestHeader("Content-Type", "application/json");
							xhr.setRequestHeader("charset", "utf-8");
						},
						success:function(data){
							data = unescape(replaceAll(data, "\\", "%"))
							organized_data = organize_json_data(data);
							if(hasFile) {
								$('#json_results').html(organized_data);
							}
							else {
								$('#json_results2').html(organized_data);
							}
							
						},
						error:function(data){
							alert(JSON.stringify(data));
						}
					});
				}

				function replaceAll(strTemp, strValue1, strValue2) { 
					while(1){
						if( strTemp.indexOf(strValue1) != -1 )
							strTemp = strTemp.replace(strValue1, strValue2);
						else
							break;
					}
					return strTemp;
				}

				function organize_json_data(data) {
					var organized_data = "";
					var space_count = 0;

					for(var i = 0; i < data.length; i++) {
						var letter = data.charAt(i);
						if(letter == "{" || letter == "[") {
							organized_data += letter + "\n";
							space_count += 2;
							organized_data += add_space(space_count);
						}
						else if(letter == ",") {
							organized_data += letter + "\n";
							organized_data += add_space(space_count);
						}
						else if(letter == "}" || letter == "]") {
							space_count -= 2;
							organized_data += "\n";
							organized_data += add_space(space_count);
							organized_data += letter;
						}
						else if (letter == ":") {
							organized_data += letter + " ";
						}
						else if(letter == " ") {
							continue;
						}
						else {
							organized_data += letter;
						}
					}
					return organized_data;
				}

				function add_space(space_count) {
					var space = "";
					for(var i = 0; i < space_count; i++) {
						space += " ";
					}
					return space;
				}
			</script>

			<!-- Footer -->
			<div id="footer-wrapper">
				<footer id="footer" class="container">
					<div class="row">
						<div class="col-2 col-6-medium col-12-small">

							<!-- Links -->
								<section class="widget links">
									<h3>SITEMAP &nbsp &nbsp &nbsp | </h3>
								</section>

						</div>
						<div class="col-2 col-6-medium col-12-small">

							<!-- Links -->
								<section class="widget links">
									<h3><a href="index.html">과제 개요</a></h3>
								</section>

						</div>
						<div class="col-2 col-6-medium col-12-small">

							<!-- Links -->
								<section class="widget links">
									<h3><a href="demo1.html">통합시연</a></h3>
									<ul class="style2">
										<li><a href="demo1-12.html">Part 1</a></li>
										<li><a href="demo1-12.html#box2">Part 2</a></li>
										<li><a href="demo1-3.html">Part 3</a></li>
										<li><a href="demo1-4.html">Part 4</a></li>
									</ul>
								</section>

						</div>
						<div class="col-2 col-6-medium col-12-small">

							<!-- Links -->
								<section class="widget links">
									<h3><a href="demo2.html">Downstream Task</a></h3>
									<ul class="style2">
										<li><a href="demo2-1.html">Part 1</a></li>
										<li><a href="demo2-2.html">Part 2</a></li>
										<li><a href="demo2-3.html">Part 3</a></li>
										<li><a href="demo2-4.html">Part 4</a></li>
										<li><a href="demo2-5.html">Part 5</a></li>
									</ul>
								</section>

						</div>
						<div class="col-2 col-6-medium col-12-small">

							<!-- Links -->
								<section class="widget links">
									<h3><a href="opensource.html">오픈소스</a></h3>
									<ul class="style2">
										<li><a href="opensource.html#dataset">데이터셋</a></li>
										<li><a href="opensource.html#code">코드</a></li>
									</ul>
								</section>

						</div>
						<div class="col-2 col-6-medium col-12-small">

							<!-- Links -->
								<section class="widget links">
									<h3><a href="contact.html">CONTACT</a></h3>
								</section>

						</div>
					</div>
					<div class="row">
						<div class="col-12">
							<div id="copyright">
								<ul class="menu">
									<li>&copy; KETI. All rights reserved</li><li>Design: <a href="http://html5up.net">HTML5 UP</a></li>
								</ul>
							</div>
						</div>
					</div>
				</footer>
			</div>

			</div>

		<!-- Scripts -->

			<script src="assets/js/jquery.min.js"></script>
			<script src="assets/js/jquery.dropotron.min.js"></script>
			<script src="assets/js/browser.min.js"></script>
			<script src="assets/js/breakpoints.min.js"></script>
			<script src="assets/js/util.js"></script>
			<script src="assets/js/main.js"></script>

	</body>
</html>