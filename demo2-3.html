<!DOCTYPE HTML>
<!--
	Alpha by HTML5 UP
	html5up.net | @ajlkn
	Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html>
	<head>
		<title>SSL</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
		<link rel="stylesheet" href="assets/css/main.css" />
		<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
	</head>
	<body class="landing is-preload">
		<div id="page-wrapper">

			<!-- Header -->
				<header id="header">
					<h1><a href="index.html">SSL</a></h1>
					<nav id="nav">
						<ul>
							<li><a href="index.html">과제 개요</a></li>
							<li><a href="results.html">결과물</a></li>
							<li>
								<a href="demo1.html" class="icon solid fa-angle-down">통합 시연</a>
								<ul>
									<li><a href="demo1.html#box1">Part 1</a></li>
									<li><a href="demo1.html#box2">Part 2</a></li>
									<li><a href="demo1.html#box3">Part 3</a></li>
									<li><a href="demo1.html#box4">Part 4</a></li>
								</ul>
							</li>
							<li>
								<a href="demo2.html" class="icon solid fa-angle-down"><strong style="color:white">Downstream Task</strong></a>
								<ul style="width:320px">
									<li><a href="demo2-1.html">1. 사전학습(RestNet50) 기반 이미지 분류 (KETI)</a></li>
									<li><a href="demo2-2.html">2. 객체탐지성공률 (Postech)</a></li>
									<li><a href="demo2-3.html">3. 문서 내 지식관계 추출 정확도 (KETI)</a></li>
									<li><a href="demo2-4.html">4. 물체의 6D 자세파악 (Birmingham)</a></li>
									<li><a href="demo2-5.html">5. 그래프 분류 정확도 (Postech)</a></li>
								</ul>
							</li>
							<li><a href="dataset.html"><strong style="color:white">Dataset</strong></a></li>
						</ul>
					</nav>
				</header>

			<!-- Banner -->
				<section id="banner">
					<h5>정보통신⦁방송 기술개발사업<br/>
						차세대 인공지능 핵심원천기술개발<h5>
					<h3>자기지도학습에 의한 시각적 상식으로<br/>
						영상에서 보이지 않는 부분을 복원하는 기술</h3>
				</section>

			<!-- Main -->
				<section id="main" class="container">
					<ul class="actions special">
						<li><a href="index.html" class="button">과제 개요</a></li>
						<li><a href="results.html" class="button">결과물</a></li>
						<li><a href="demo1.html" class="button">통합 시연</a></li>
						<li><a href="demo2.html" class="button primary">Downstream Task</a></li>
						<li><a href="dataset.html" class="button">Dataset</a></li>
					</ul>

					<div class="box">
							<table>
								<thead style="border : 0px;">
									<tr>
										<td>
											<ul class="actions fit">
												<li><a href="demo2-1.html" class="button" style="padding:0px">1. 사전학습(RestNet50) 기반 이미지 분류 (KETI)</a></li>
											</ul>
										</td>
										<td>
											<ul class="actions fit">
												<li><a href="demo2-2.html" class="button">2. 객체탐지성공률 (Postech)</a></li>
											</ul>
										</td>
										<td>
											<ul class="actions fit">
												<li><a href="demo2-3.html" class="button alt" style="color: black;">3. 문서 내 지식관계 추출 정확도 (KETI)</a></li>
											</ul>
										</td>
									</tr>
								</thead>
								<thead style="border : 0px;">
									<tr>
										<td>
											<ul class="actions fit">
												<li><a href="demo2-4.html" class="button">4. 물체의 6D 자세파악 (Birmingham)</a></li>
											</ul>
										</td>
										<td>
											<ul class="actions fit">
												<li><a href="demo2-5.html" class="button">5. 그래프 분류 정확도 (Postech)</a></li>
											</ul>
										</td>
									</tr>
								</thead>
							</table>
					</div>

					<div class="box">
						<h3>Part 3</h3>
						<p>문서 내 지식관계 추출 정확도 (KETI)</p>
						<p>
						<br/><br/>
						<p><h4>1. 파일 입력</h4></p>
						<strong>JSON 파일 : &nbsp;&nbsp;&nbsp;</strong>
						<input type="file" id="file_json" accept="application/JSON" onchange="setJsonThumbnail(event, 'json_preview')"/>
						<br/><br/><br/>
						<h4>파일 미리보기</h4>
						<pre id="json_preview">json file preview</pre>
						<input id="submit" type="submit" onclick="submitData(event, 'relation_extraction', true)">
						<br/><br/>
						<h4>결과</h4>
						<pre id=json_results>json results</pre>
						<br/><br/>

						<table>
							<thead> 
								<th></th>
							</thead>
						</table>

						<br/>
						<p><h4>2. 사용자 텍스트 입력</h4></p>
						1) 문장을 아래에 입력하세요. <br/>
						2) 단어를 드래그하여 선택하세요. <br/>
						3) 선택한 단어가 맞으면 "단어 추가" 버튼을 누르세요. <br/>
						4) 단어 삭제를 원할 경우 해당 단어를 클릭하세요. <br/>
						5) 단어 선택을 원료했을 때, "JSON 생성" 버튼을 누르세요. <br/>
						6) JSON이 제대로 생성되었으면 "Submit" 버튼을 누르세요. <br/><br/>
						*** 선택된 단어는 subject, object 순서대로 입력됩니다. 짝수 개의 단어를 입력하세요. ***<br/>
						예) "사용자", "문장", "단어", "짝수" 를 선택할 경우, 각각 subject, object 순서로 ("사용자", "문장"), ("단어", "짝수") 로 묶입니다.
						<br/><br/>
						문장 입력 : &nbsp;&nbsp;&nbsp;<textarea id="sentence" style="border-color:rgb(221, 221, 221); resize:none" placeholder="문장을 입력하세요." onselect="getSelectedText()"></textarea>
						<br/>
						선택된 단어 :
						<div class="row gtr-uniform gtr-50">
							<div class="col-9 col-12-mobilep">
								<pre id="word"/>
							</div>
							<div class="col-3 col-12-mobilep">
								<input type="button" value="단어 추가" class="fit" style="height:100%;" onclick="addWord()"/>
							</div>
						</div>

						<br/>
						<div id="selected_words"></div>
						<br/><input type="submit" id="generator" value="JSON 생성" onclick="generateJson()">
						<br/><br/>
						<h4>생성된 JSON</h4>
						<pre id="json_preview_user">json preview</pre>
						
						<input id="submit" type="submit" onclick="submitData(event, 'relation_extraction', false)">
						<br/><br/>
						<h4>결과</h4>
						<pre id=json_results2>json results</pre>
					</div>



					<script>
						function getSelectedText() {
							var txtarea = document.getElementById("sentence");
							var start = txtarea.selectionStart;
							var finish = txtarea.selectionEnd;
							var sel = txtarea.value.substring(start, finish);
							$('#word').html(sel + "   [" + start + "," + finish + "]");
						}
						
						var wordCount = 0;
						var wordArray = [];
						function addWord() {
							var word = document.getElementById("word").innerText;
							if(word == "							") {
								alert("문장에서 단어를 드래그하여 선택하세요.");
								return 1;
							}

							var wordarea = document.getElementById("selected_words");
							var button = document.createElement("input");
							button.setAttribute("type", "button");
							button.setAttribute("value", word);
							button.setAttribute("style", "background-color: silver; color: black");
							button.id = "word" + wordCount;
							button.onclick = function(event) {
								event.target.remove();

								var word_num = button.id.substring(4, button.id.length);
								var idx = wordArray.indexOf(word_num);
								wordArray.splice(idx, 1);
							};
							
							wordarea.append(button);
							wordarea.append("\u00A0");

							wordArray.push(wordCount + "");
							wordCount += 1;
						}

						function generateJson() {
							if(wordArray.length == 0) {
								alert("단어를 선택하세요.");
								return 1;
							}
							else if(wordArray.length % 2 != 0) {
								alert("짝수 개의 단어를 선택하세요.");
								return 1;
							}

							var sentence = document.getElementById("sentence");

							var json_doc = new Object();
							json_doc["text"] = sentence.value;
							json_doc["language"] = "kr";
							json_doc["domain"] = "common-sense";

							var pairs = [];
							var subject = "";
							var object = "";
							for(var i = 0; i < wordArray.length; i++) {
								var wordId = "word" + wordArray[i];
								var wordValue = document.getElementById(wordId).value;
								var splitedWord = wordValue.split("   ");
								var wordLocation = splitedWord[1];
								var splitedWordLocation = wordLocation.split(",");

								var start = splitedWordLocation[0].slice(1) * 1;
								var end = splitedWordLocation[1].slice(0, -1) * 1;
								if(i % 2 == 1) {
									object = [start, end-1];
									pairs.push([subject, object]);

									subject = "";
									object = "";
								}
								else {
									subject = [start, end-1];
								}
							}

							var jsonArray = new Object();
							jsonArray["doc"] = json_doc;
							jsonArray["arg_pairs"] = pairs;
							jsonArray = JSON.stringify(jsonArray);

							$("#json_preview_user").html(jsonArray);
						}

						function setJsonThumbnail(event, json_area) {
							var reader = new FileReader(); 
							reader.onload = function(event) { 
								$('#'+json_area).html("");
								$('#'+json_area).html(event.target.result);
							};
							reader.readAsText(event.target.files[0]);
						}

						function submitData(event, name, hasFile) {
							input_url = "https://ketiair.com:10001/api/" + name;

							if(hasFile) {
								var hasJson = false;
								var readerJson = new FileReader();

								alertIfFileNotSelected(readerJson);

								readerJson.onload = function() {
									$('#json_results').html("loading...");
									postData(input_url, readerJson.result, hasFile);
								}
							}
							else {
								var generatedJson = document.getElementById("json_preview_user").innerText;
								$('#json_results2').html("loading...");
								postData(input_url, generatedJson, hasFile);
							}
						}

						function alertIfFileNotSelected(reader) {
							var json = document.getElementById("file_json").files[0];
							try {
								reader.readAsText(json);
							}
							catch(err) {
								alert("JSON 파일을 선택하세요.");
							}
						}

						function postData(input_url, jsonArray, hasFile) {
							$.ajax({
								type: "POST",
								url: input_url,
								data: jsonArray,
								beforeSend: function(xhr) {
									xhr.setRequestHeader("Content-Type", "application/json");
									xhr.setRequestHeader("charset", "utf-8");
								},
								success:function(data){
									data = unescape(replaceAll(data, "\\", "%"))
									organized_data = organize_json_data(data);
									if(hasFile) {
										$('#json_results').html(organized_data);
									}
									else {
										$('#json_results2').html(organized_data);
									}
									
								},
								error:function(data){
									alert(JSON.stringify(data));
								}
							});
						}

						function replaceAll(strTemp, strValue1, strValue2) { 
							while(1){
								if( strTemp.indexOf(strValue1) != -1 )
									strTemp = strTemp.replace(strValue1, strValue2);
								else
									break;
							}
							return strTemp;
						}

						function organize_json_data(data) {
							var organized_data = "";
							var space_count = 0;

							for(var i = 0; i < data.length; i++) {
								var letter = data.charAt(i);
								if(letter == "{" || letter == "[") {
									organized_data += letter + "\n";
									space_count += 2;
									organized_data += add_space(space_count);
								}
								else if(letter == ",") {
									organized_data += letter + "\n";
									organized_data += add_space(space_count);
								}
								else if(letter == "}" || letter == "]") {
									space_count -= 2;
									organized_data += "\n";
									organized_data += add_space(space_count);
									organized_data += letter;
								}
								else if (letter == ":") {
									organized_data += letter + " ";
								}
								else if(letter == " ") {
									continue;
								}
								else {
									organized_data += letter;
								}
							}
							return organized_data;
						}

						function add_space(space_count) {
							var space = "";
							for(var i = 0; i < space_count; i++) {
								space += " ";
							}
							return space;
						}
					</script>
				</section>

			<!-- Footer -->
				<footer id="footer">
					<ul class="copyright">
						<li>&copy; KETI. All rights reserved.</li><li>Design: <a href="http://html5up.net">HTML5 UP</a></li>
					</ul>
				</footer>

		</div>

		<!-- Scripts -->
		<script src="assets/js/jquery.min.js"></script>
		<script src="assets/js/jquery.dropotron.min.js"></script>
		<script src="assets/js/jquery.scrollex.min.js"></script>
		<script src="assets/js/browser.min.js"></script>
		<script src="assets/js/breakpoints.min.js"></script>
		<script src="assets/js/util.js"></script>
		<script src="assets/js/main.js"></script>
	</body>
</html>